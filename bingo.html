<script src="underscore.js"></script>
<style>
#board {
	display: block;
	width: 500px;
}

#board .header {
	border-bottom: 4px solid black;
}

#board ul {
	width: 90px;
	float: left;
	margin: 0;
	padding: 0;
}

#board li {
	border: 1px solid black;
    width: 50px;
    height: 50px;
    float: left;
    display: block;
    margin: 0;
    padding: 20px;
    padding-top:35px;
    padding-bottom:0;
    text-align: center;
}
</style>
<body>

<div id="caller">
	<div><input type="button" value="▶️ play" id="play" /></div>
	<div><input type="button" value="⏸ pause" id="pause" /></div>
	<div><input type="number" id="timeout" value=10></div>
	<ul id="numbers">

	</ul>
</div>

<div id="board">
	<ul class="b"><li class="header">B</li></ul>
	<ul class="i"><li class="header">I</li></ul>
	<ul class="n"><li class="header">N</li></ul>
	<ul class="g"><li class="header">G</li></ul>
	<ul class="o"><li class="header">O</li></ul>
</div>


<script>

const board = document.querySelector('#board');

const nums = {};
for (var i = 1; i < 76; i++) {
	let letter;
	if (i < 16) {
		letter = 'b';
	} else if (i < 31) {
		letter = 'i';
	} else if (i < 46) {
		letter = 'n';
	} else if (i < 61) {
		letter = 'g';
	} else {
		letter = 'o';
	}
	nums[i] = {text: `${letter}${i}`, number: i, letter, used: false};
}

const getNumber = (letter) => {
	let lower = 1;
	let upper = 75;

	switch (letter) {
		case 'b':
			lower = 1;
			upper = 15;
			break;
		case 'i':
			lower = 16;
			upper = 30;
			break;
		case 'n':
			lower = 31;
			upper = 45;
			break;
		case 'g':
			lower = 46;
			upper = 60;
			break;
		case 'o':
			lower = 61;
			upper = 75;
			break;
		default:
			lower = 1;
			upper = 75;
	}

	const num = _.random(lower, upper);

	if (nums[num].used) {
		return getNumber(letter);
	}

	nums[num].used = true;
	return nums[num];
}

const resetNumbers = () => {
	for (var i = 1; i < 76; i++) {
		nums[i].used = false;
	}
}

const addSquare = (number) => {
	const numText = document.createTextNode(number.number);
	const numLi = document.createElement('li');
	numLi.appendChild(numText);
	console.log(`#board .${number.letter}`)
	document.querySelector(`#board .${number.letter}`).appendChild(numLi);
}

const fillBoard = () => {
	for (let i = 1; i < 26; i++) {
		let number;
		if (i <= 5) {
			number = getNumber('b');
		} else if (i <= 10) {
			number = getNumber('i');
		} else if (i <= 15) {
			number = getNumber('n');
		} else if (i <= 20) {
			number = getNumber('g');
		} else {
			number = getNumber('o');
		}
		addSquare(number);
	}
}

fillBoard();
resetNumbers();

const callNumber = () => {
	const newNumber = getNumber();
	const numText = document.createTextNode(newNumber.text);
	const utterThis = new SpeechSynthesisUtterance(newNumber.text);
	synth.speak(utterThis);
	const numLi = document.createElement('li');
	numLi.appendChild(numText);
	document.querySelector('#numbers').appendChild(numLi);
}

const synth = window.speechSynthesis;
const playButton = document.querySelector('#play');
const pauseButton = document.querySelector('#pause');
let paused = false;

const pause = () => {
	window.clearTimeout(timeout);
	paused = true;
}

const play = () => {
	paused = false;
	callNext();
}
let timeout;
const callNext = () => {
	if (!paused) {
		callNumber();

		const time = document.querySelector('#timeout').value;
		timeout = window.setTimeout(callNext, time * 1000);
	}
}

playButton.addEventListener('click', play);
pauseButton.addEventListener('click', pause);
</script>
</body>
